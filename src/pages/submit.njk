---
layout: layouts/base.njk
title: Submit Your Demo
description: Share your design style implementation with the community. All submissions are reviewed by instructors before publishing.
permalink: /submit/
---

{% import "macros/form-field.njk" as field %}

<div class="max-w-container-md mx-auto px-6 section-padding">
  <div class="text-center mb-12">
    <h1 class="text-h1 mb-4">Submit Your Demo</h1>
    <p class="text-neutral-500">
      Share your design style implementation with the community.
      All submissions are reviewed by instructors before publishing.
    </p>
  </div>

  {# Success Message (hidden by default) #}
  <div id="success-message" class="hidden bg-green-50 border-l-4 border-green-500 p-8 text-center mb-8">
    <span class="text-4xl block mb-4">‚úì</span>
    <h2 class="text-2xl font-bold text-green-700 mb-2">Thank you! Your submission has been received.</h2>
    <p class="text-green-600 mb-6">
      We'll review your submission and notify you by email.
    </p>
    <a href="{{ '/' | url }}" class="btn btn-primary bg-green-600 hover:bg-green-700 inline-block">
      Back to Gallery
    </a>
  </div>

  {# Error Message (hidden by default) #}
  <div id="error-message" class="hidden bg-red-50 border-l-4 border-red-500 p-6 mb-8" role="alert">
    <div class="flex items-start">
      <span class="text-2xl mr-3" aria-hidden="true">‚ö†Ô∏è</span>
      <div>
        <h2 class="text-lg font-bold text-red-700 mb-1">Submission Failed</h2>
        <p id="error-message-text" class="text-red-600"></p>
        <button
          type="button"
          id="error-dismiss-btn"
          class="mt-3 text-sm text-red-700 underline hover:no-underline"
        >
          Dismiss and try again
        </button>
      </div>
    </div>
  </div>

  {# Submission Form #}
  <form
    id="submission-form"
    class="space-y-6"
    method="POST"
    action="/.netlify/functions/submit-form"
    netlify
    data-netlify="true"
    netlify-honeypot="bot-field"
    name="demo-submission"
    novalidate
  >
    {# Honeypot for spam prevention #}
    <p class="hidden">
      <label>Don't fill this out if you're human: <input name="bot-field" /></label>
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {{ field.input('name', 'Full Name', 'text', 'Your name', true) }}
      {{ field.input('email', 'Email', 'email', 'you@email.com', true) }}
    </div>

    {# Design styles populated from Sanity CMS #}
    {% set styleOptions = [] %}
    {% for style in designStyles.styles %}
      {% set styleOptions = (styleOptions.push({ value: style.slug.current or style.slug, label: style.title }), styleOptions) %}
    {% endfor %}
    {{ field.select('style', 'Design Style', styleOptions, true, 'Select the design style your demo represents') }}

    {{ field.input('demoUrl', 'Demo URL', 'url', 'https://yourusername.github.io/demo', true, 'Must be a publicly accessible URL (GitHub Pages, Netlify, etc.)') }}

    {# Screenshot Upload #}
    <div class="form-group">
      <label for="screenshot" class="form-label">
        Screenshot <span class="text-swiss-red">*</span>
      </label>

      {# Upload Container - toggles between upload state and preview state #}
      <div
        id="screenshot-upload-container"
        class="relative border-2 border-dashed border-black p-8 text-center transition-colors focus-within:border-swiss-red hover:border-swiss-red"
        role="group"
        aria-labelledby="screenshot-upload-label"
      >
        {# Upload State (shown when no file selected) #}
        <div id="screenshot-upload-state">
          <input
            type="file"
            id="screenshot"
            name="screenshot"
            accept="image/png,image/jpeg,image/webp"
            required
            aria-required="true"
            aria-describedby="screenshot-helper screenshot-error"
            aria-invalid="false"
            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
          />
          <div id="screenshot-upload-label" class="pointer-events-none">
            <span class="text-4xl block mb-2" aria-hidden="true">üì∑</span>
            <p id="screenshot-helper" class="text-sm text-neutral-500">Click to upload or drag and drop</p>
            <p class="text-caption text-neutral-400 mt-1">PNG, JPG, WebP up to 5MB</p>
          </div>
        </div>

        {# Preview State (shown when file is selected) #}
        <div id="screenshot-preview-state" class="hidden">
          <img
            id="screenshot-preview-image"
            src=""
            alt="Preview of selected screenshot"
            class="max-w-[300px] max-h-[200px] mx-auto object-contain mb-3"
          />
          <div class="text-sm text-neutral-600">
            <p id="screenshot-file-name" class="font-medium"></p>
            <p id="screenshot-file-size" class="text-neutral-400"></p>
          </div>
          <button
            type="button"
            id="screenshot-remove-btn"
            class="mt-3 px-4 py-2 text-sm text-swiss-red border border-swiss-red rounded hover:bg-swiss-red hover:text-white transition-colors min-h-[44px] min-w-[44px]"
            aria-label="Remove selected image"
          >
            Remove
          </button>
        </div>

        {# Screen reader status announcements #}
        <div id="screenshot-status" class="sr-only" aria-live="polite" aria-atomic="true"></div>
      </div>

      <p id="screenshot-error" class="form-error hidden mt-2" role="alert"></p>
    </div>

    {{ field.textarea('authenticity', 'Authenticity Explanation', 5, 'Explain how your demo authentically represents the design style. Reference specific typography, color, layout, and compositional choices...', true, 'Minimum 50 characters required') }}

    <div class="space-y-4 pt-6 border-t border-neutral-200">
      <p class="text-sm font-medium text-neutral-700">Consent & Preferences</p>

      {{ field.checkbox('consent', 'I consent to my name and submission being displayed publicly on MyWebClass.org if approved. <a href="' + ('/legal/privacy/' | url) + '" class="underline">Privacy Policy</a>', true) }}

      <div class="pl-0 text-xs text-neutral-500 -mt-2 mb-4">
        <span class="text-swiss-red">*</span> Required to submit
      </div>

      {{ field.checkbox('marketing', 'I\'d like to receive updates, tips, and news about MyWebClass.org (optional)', false) }}

      <p class="text-xs text-neutral-400 pl-0 -mt-2">
        You can unsubscribe at any time. We never share your email.
      </p>
    </div>

    <button
      type="submit"
      class="btn btn-primary w-full"
    >
      Submit for Review
    </button>
  </form>
</div>

<script src="{{ '/scripts/submission-form.js' | url }}" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Enhanced screenshot upload with preview
    const screenshotInput = document.getElementById('screenshot');
    const uploadContainer = document.getElementById('screenshot-upload-container');
    const uploadState = document.getElementById('screenshot-upload-state');
    const previewState = document.getElementById('screenshot-preview-state');
    const previewImage = document.getElementById('screenshot-preview-image');
    const fileNameEl = document.getElementById('screenshot-file-name');
    const fileSizeEl = document.getElementById('screenshot-file-size');
    const removeBtn = document.getElementById('screenshot-remove-btn');
    const statusEl = document.getElementById('screenshot-status');
    const errorEl = document.getElementById('screenshot-error');

    const MAX_SIZE_BYTES = 5 * 1024 * 1024; // 5MB
    const ALLOWED_TYPES = ['image/png', 'image/jpeg', 'image/webp'];

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function showError(message) {
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.classList.remove('hidden');
      }
      if (uploadContainer) {
        uploadContainer.classList.add('error');
      }
      if (screenshotInput) {
        screenshotInput.setAttribute('aria-invalid', 'true');
      }
      // Announce to screen readers
      if (statusEl) {
        statusEl.textContent = 'Error: ' + message;
      }
    }

    function clearError() {
      if (errorEl) {
        errorEl.textContent = '';
        errorEl.classList.add('hidden');
      }
      if (uploadContainer) {
        uploadContainer.classList.remove('error');
      }
      if (screenshotInput) {
        screenshotInput.setAttribute('aria-invalid', 'false');
      }
    }

    function showPreview(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        if (previewImage) {
          previewImage.src = e.target.result;
        }
        if (fileNameEl) {
          fileNameEl.textContent = file.name;
        }
        if (fileSizeEl) {
          fileSizeEl.textContent = formatFileSize(file.size);
        }
        if (uploadState) {
          uploadState.classList.add('hidden');
        }
        if (previewState) {
          previewState.classList.remove('hidden');
        }
        // Announce to screen readers
        if (statusEl) {
          statusEl.textContent = 'Image selected: ' + file.name + ', ' + formatFileSize(file.size);
        }
      };
      reader.readAsDataURL(file);
    }

    function resetUploadVisualState() {
      if (screenshotInput) {
        screenshotInput.value = '';
      }
      if (previewImage) {
        previewImage.src = '';
      }
      if (fileNameEl) {
        fileNameEl.textContent = '';
      }
      if (fileSizeEl) {
        fileSizeEl.textContent = '';
      }
      if (uploadState) {
        uploadState.classList.remove('hidden');
      }
      if (previewState) {
        previewState.classList.add('hidden');
      }
    }

    function resetUpload() {
      resetUploadVisualState();
      clearError();
      // Announce to screen readers
      if (statusEl) {
        statusEl.textContent = 'Image removed. Ready to upload a new image.';
      }
    }

    function handleFile(file) {
      clearError();

      // Validate file type
      if (!ALLOWED_TYPES.includes(file.type)) {
        resetUploadVisualState();
        showError('Please upload a JPG, PNG, or WebP image');
        return;
      }

      // Validate file size
      if (file.size > MAX_SIZE_BYTES) {
        resetUploadVisualState();
        showError('Screenshot must be less than 5MB');
        return;
      }

      // Show preview
      showPreview(file);
    }

    if (screenshotInput) {
      screenshotInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          handleFile(this.files[0]);
        }
      });
    }

    if (removeBtn) {
      removeBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        resetUpload();
        // Focus back to upload area for keyboard users
        if (screenshotInput) {
          screenshotInput.focus();
        }
      });
    }

    // Drag and drop support
    if (uploadContainer) {
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadContainer.addEventListener(eventName, function(e) {
          e.preventDefault();
          e.stopPropagation();
        });
      });

      ['dragenter', 'dragover'].forEach(eventName => {
        uploadContainer.addEventListener(eventName, function() {
          uploadContainer.classList.add('drag-over');
        });
      });

      ['dragleave', 'drop'].forEach(eventName => {
        uploadContainer.addEventListener(eventName, function() {
          uploadContainer.classList.remove('drag-over');
        });
      });

      uploadContainer.addEventListener('drop', function(e) {
        const dt = e.dataTransfer;
        if (dt && dt.files && dt.files[0]) {
          // Set the file to the input for form submission
          const dataTransfer = new DataTransfer();
          dataTransfer.items.add(dt.files[0]);
          if (screenshotInput) {
            screenshotInput.files = dataTransfer.files;
          }
          handleFile(dt.files[0]);
        }
      });
    }

    // Submission error handling functions
    function showSubmissionError(message) {
      const errorEl = document.getElementById('error-message');
      const errorText = document.getElementById('error-message-text');
      if (errorEl && errorText) {
        errorText.textContent = message;
        errorEl.classList.remove('hidden');
        errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        // Announce to screen readers
        errorEl.setAttribute('aria-live', 'assertive');
      }
    }

    function hideSubmissionError() {
      const errorEl = document.getElementById('error-message');
      if (errorEl) {
        errorEl.classList.add('hidden');
      }
    }

    // Add dismiss button handler
    const errorDismissBtn = document.getElementById('error-dismiss-btn');
    if (errorDismissBtn) {
      errorDismissBtn.addEventListener('click', function() {
        hideSubmissionError();
      });
    }

    // Convert File to base64 string
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          // Remove data URL prefix (e.g., "data:image/png;base64,")
          const base64 = reader.result.split(',')[1];
          resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Form submission handler with validation and Netlify function
    const form = document.getElementById('submission-form');
    const successMessage = document.getElementById('success-message');

    if (form && successMessage) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Validate form using the external validation script
        const firstInvalidField = window.validateSubmissionForm ? window.validateSubmissionForm() : null;

        if (firstInvalidField) {
          // Focus the first invalid field
          const invalidInput = document.getElementById(firstInvalidField);
          if (invalidInput) {
            invalidInput.focus();
          }
          return;
        }

        // Gather form data
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
          // Skip file data and honeypot for JSON submission
          if (key !== 'screenshot' && key !== 'bot-field') {
            data[key] = value;
          }
        });

        // Convert checkbox values to booleans
        // Checkboxes in FormData have value "on" when checked, absent when unchecked
        data.consent = formData.has('consent');
        data.marketing = formData.has('marketing');

        // Add timestamp
        data.timestamp = new Date().toISOString();

        // Convert screenshot to base64
        const screenshotFile = formData.get('screenshot');
        if (screenshotFile && screenshotFile.size > 0) {
          try {
            const base64 = await fileToBase64(screenshotFile);
            data.screenshot = base64;
            data.screenshotFilename = screenshotFile.name;
            data.screenshotMimeType = screenshotFile.type;
          } catch (err) {
            console.error('Failed to encode screenshot:', err);
            showSubmissionError('Failed to process screenshot. Please try again.');
            return;
          }
        }

        // Disable submit button while processing
        const submitButton = form.querySelector('button[type="submit"]');
        const originalButtonText = submitButton ? submitButton.textContent : 'Submit for Review';
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.innerHTML = '<span class="inline-block animate-spin mr-2">‚è≥</span> Submitting...';
          submitButton.classList.add('opacity-75', 'cursor-not-allowed');
        }

        try {
          const response = await fetch('/.netlify/functions/submit-form', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          if (response.ok) {
            const responseData = await response.json().catch(() => ({}));
            form.classList.add('hidden');
            successMessage.classList.remove('hidden');
            successMessage.scrollIntoView({ behavior: 'smooth' });

            // Show warning if screenshot upload failed
            if (responseData.warning) {
              const warningEl = document.createElement('p');
              warningEl.className = 'text-amber-600 text-sm mt-4';
              warningEl.textContent = responseData.warning;
              successMessage.appendChild(warningEl);
            }
          } else {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.message || 'Submission failed');
          }
        } catch (error) {
          console.error('Form submission error:', error);
          showSubmissionError(error.message || 'Something went wrong. Please try again.');

          // Re-enable submit button
          if (submitButton) {
            submitButton.disabled = false;
            submitButton.innerHTML = originalButtonText;
            submitButton.classList.remove('opacity-75', 'cursor-not-allowed');
          }
        }
      });
    }
  });
</script>
