---
pagination:
  data: designStyles.styles
  size: 1
  alias: style
permalink: "/styles/{{ style.slug.current or style.slug }}/"
layout: layouts/base.njk
---

{% set title = style.title %}
{% set description = style.description %}

{# Back Navigation #}
<div class="container-custom py-4">
  <a href="{{ '/styles/' | url }}" class="text-sm text-neutral-500 hover:text-black inline-flex items-center gap-2">
    ‚Üê Back to Styles
  </a>
</div>

{# Hero Image #}
{% if style.heroImage and style.heroImage.asset and style.heroImage.asset._ref %}
  {% set imgRef = style.heroImage.asset._ref | replace('image-', '') | replace('-jpg', '.jpg') | replace('-jpeg', '.jpeg') | replace('-png', '.png') | replace('-webp', '.webp') | replace('-gif', '.gif') %}
  <section class="relative w-full h-64 md:h-80 lg:h-96 overflow-hidden">
    <img
      src="https://cdn.sanity.io/images/{{ sanityConfig.projectId }}/{{ sanityConfig.dataset }}/{{ imgRef }}?w=1200&fit=crop&auto=format"
      srcset="https://cdn.sanity.io/images/{{ sanityConfig.projectId }}/{{ sanityConfig.dataset }}/{{ imgRef }}?w=640&fit=crop&auto=format 640w,
              https://cdn.sanity.io/images/{{ sanityConfig.projectId }}/{{ sanityConfig.dataset }}/{{ imgRef }}?w=1024&fit=crop&auto=format 1024w,
              https://cdn.sanity.io/images/{{ sanityConfig.projectId }}/{{ sanityConfig.dataset }}/{{ imgRef }}?w=1200&fit=crop&auto=format 1200w"
      sizes="100vw"
      alt="{{ style.heroImage.alt or style.title }}"
      class="w-full h-full object-cover"
      loading="eager"
    />
  </section>
{% else %}
  {# Fallback: Accessible colored banner with emoji #}
  <section
    class="relative w-full h-48 md:h-64 flex items-center justify-center"
    style="background-color: {{ style.accentColor or '#E53935' }}20;"
    role="img"
    aria-label="{{ style.title }} decorative banner"
  >
    <span class="text-8xl" aria-hidden="true">{{ style.thumbnail or 'üé®' }}</span>
  </section>
{% endif %}

{# Header #}
<section class="border-b-2 border-black">
  <div class="container-custom py-8">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
      <div>
        <span class="text-overline text-neutral-400">{{ style.era or 'Design Movement' }}</span>
        <h1 class="text-h1 mt-2">{{ style.title }}</h1>
      </div>
      <div
        class="w-16 h-16 flex-shrink-0"
        style="background-color: {{ style.accentColor or '#E53935' }};"
      ></div>
    </div>
    {% if style.description %}
    <p class="text-lg text-neutral-600 mt-6 max-w-2xl">{{ style.description }}</p>
    {% endif %}
  </div>
</section>

{# Demo Preview #}
<section class="border-b-2 border-black">
  <div class="container-custom py-12">
    <h2 class="text-overline text-neutral-400 mb-6">Live Demo</h2>
    <div
      class="h-96 border-2 border-black flex items-center justify-center"
      style="background-color: {{ style.accentColor or '#E53935' }}10;"
    >
      <div class="text-center">
        <span class="text-8xl block mb-4">{{ style.thumbnail or 'üé®' }}</span>
        <p class="text-neutral-500 mb-4">Interactive {{ style.title }} Demo</p>
        {% if style.demoUrl %}
        <a href="{{ style.demoUrl }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary text-sm">
          Open Full Demo ‚Üó
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{# Educational Content #}
<section class="section-padding">
  <div class="container-custom">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
      {# Main Content #}
      <div class="lg:col-span-8">
        <h2 class="text-h2 mb-6">Origins & History</h2>
        <div class="text-lg text-neutral-600 leading-relaxed mb-8">
          {# Handle Sanity Portable Text (block content) vs plain string #}
          {% if style.history %}
            {% if style.history[0] and style.history[0].children %}
              {# Portable Text - extract text from blocks #}
              {% for block in style.history %}
                {% if block.children %}
                  <p class="mb-4">{% for span in block.children %}{{ span.text }}{% endfor %}</p>
                {% endif %}
              {% endfor %}
            {% else %}
              {# Plain string #}
              <p>{{ style.history }}</p>
            {% endif %}
          {% elif style.origin %}
            <p>{{ style.origin }}</p>
          {% else %}
            <p>History coming soon.</p>
          {% endif %}
        </div>

        <h2 class="text-h2 mb-6">Key Characteristics</h2>
        <ul class="space-y-3 mb-8">
          {% for char in style.characteristics %}
          <li class="flex items-start gap-3">
            <div
              class="w-2 h-2 mt-2 flex-shrink-0"
              style="background-color: {{ style.accentColor or '#E53935' }};"
            ></div>
            <span class="text-neutral-600">{{ char }}</span>
          </li>
          {% endfor %}
        </ul>

        <h2 class="text-h2 mb-6">Why This Demo Is Authentic</h2>
        <p class="text-neutral-600 leading-relaxed">
          This implementation faithfully recreates the {{ style.title }} through
          careful attention to typography, grid systems, color usage, and compositional
          principles documented in the original movement. Every design decision
          is grounded in historical research.
        </p>

        {# Gallery Images #}
        {% if style.galleryImages and style.galleryImages.length %}
        <h2 class="text-h2 mb-6 mt-12">Example Gallery</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {% for image in style.galleryImages %}
            {% if image.asset and image.asset._ref %}
              {% set galleryImgRef = image.asset._ref | replace('image-', '') | replace('-jpg', '.jpg') | replace('-jpeg', '.jpeg') | replace('-png', '.png') | replace('-webp', '.webp') | replace('-gif', '.gif') %}
              <figure class="overflow-hidden border-2 border-black">
                <img
                  src="https://cdn.sanity.io/images/{{ sanityConfig.projectId }}/{{ sanityConfig.dataset }}/{{ galleryImgRef }}?w=600&fit=crop&auto=format"
                  alt="{{ image.alt or style.title ~ ' example' }}"
                  class="w-full h-48 object-cover"
                  loading="lazy"
                />
              </figure>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}
      </div>

      {# Sidebar #}
      <div class="lg:col-span-4">
        <div class="bg-neutral-100 p-6 sticky top-24">
          <h3 class="font-bold mb-4">Style Guide</h3>

          <div class="mb-6">
            <span class="text-caption text-neutral-400 uppercase tracking-wider">Color Palette</span>
            <div class="flex gap-2 mt-2 flex-wrap">
              {% for color in style.colorPalette %}
              {% set colorHex = color.hex or color %}
              <div
                class="w-8 h-8 {% if colorHex == '#FFFFFF' %}border border-black{% endif %}"
                style="background-color: {{ colorHex }};"
                title="{{ colorHex }}"
              ></div>
              {% endfor %}
            </div>
          </div>

          <div class="mb-6">
            <span class="text-caption text-neutral-400 uppercase tracking-wider">Typography</span>
            <p class="mt-2 font-bold">{{ style.typography.primaryFont or style.typography or 'Sans-serif' }}</p>
            {% if style.typography.secondaryFont %}
            <p class="text-sm text-neutral-600">Secondary: {{ style.typography.secondaryFont }}</p>
            {% endif %}
            {% if style.typography.notes %}
            <p class="text-sm text-neutral-500 mt-1">{{ style.typography.notes | truncate(100) }}</p>
            {% endif %}
          </div>

          {% if style.gridSystem %}
          <div class="mb-6">
            <span class="text-caption text-neutral-400 uppercase tracking-wider">Grid</span>
            <p class="mt-2 text-sm text-neutral-600">{{ style.gridSystem }}</p>
          </div>
          {% endif %}

{# TODO: Implement style guide PDF generation in future story #}
        </div>
      </div>
    </div>
  </div>
</section>

{# Related Articles Section (AC2) #}
{% set relatedArticles = [] %}
{% for article in articles %}
  {% if article.relatedStyle and article.relatedStyle._id == style._id %}
    {% set relatedArticles = (relatedArticles.push(article), relatedArticles) %}
  {% endif %}
{% endfor %}

{% if relatedArticles.length %}
<section class="border-t-2 border-black">
  <div class="container-custom py-12">
    <h2 class="text-h3 mb-6">Related Reading</h2>
    <div class="space-y-4">
      {% for article in relatedArticles %}
      <a
        href="{{ '/articles/' | url }}{{ article.slug.current or article.slug }}/"
        class="block p-4 border-2 border-black hover:bg-neutral-100 transition-colors min-h-[44px]"
      >
        <h3 class="font-bold mb-1">{{ article.title }}</h3>
        {% if article.author %}
        <span class="text-sm text-neutral-500">by {{ article.author.name }}</span>
        {% endif %}
      </a>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{# Community Submissions Section - Show submissions for this style #}
{% import "macros/card.njk" as cards with context %}
{% set styleSubmissions = [] %}
{% for submission in communitySubmissions %}
  {% if submission.styleRef and submission.styleRef._id == style._id %}
    {% set styleSubmissions = (styleSubmissions.push(submission), styleSubmissions) %}
  {% endif %}
{% endfor %}

{% if styleSubmissions.length %}
<section class="border-t-2 border-black section-padding">
  <div class="container-custom">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
      <div>
        <span class="text-overline text-neutral-400">Student Work</span>
        <h2 class="text-h3 mt-2">Community Submissions</h2>
      </div>
      <p class="text-neutral-500 text-sm">
        {{ styleSubmissions.length }} submission{% if styleSubmissions.length != 1 %}s{% endif %} for this style
      </p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for submission in styleSubmissions %}
        {{ cards.submissionCard(submission) }}
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}
